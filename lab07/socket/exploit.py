from pwn import *
from ctypes import cdll

libc = cdll.LoadLibrary("libc.so.6")

choices = ['rock', 'paper', 'scissors']

name = b"kobi"
s = remote("localhost", 1234)
libc.srand(libc.time(0) + u32(name))

s.recv(100) # read banner
s.send(name + b"\n")
s.recv(100) # read "your turn" message

his_choice_index = libc.rand() % 3
his_choice = choices[his_choice_index]

# a simple and nice calculation to choose the choice we have to make in order to win
# we always need the next element in the list in a cyclic order
our_choice = choices[(his_choice_index + 1) % 3]
log.info(f'Server is expected to choose "{his_choice}". Therefore, we choose "{our_choice}".')

# send our choice
s.send(bytes(our_choice, encoding='utf-8') + b'\n')

log.info('Checking to see if we won...')
response = s.recv(100)

if b'You win!' in response:
    log.info('Exploit succeeded. We won the game.')
else:
    log.info('Exploit failed.')
s.close()



